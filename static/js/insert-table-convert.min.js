$(document).ready(function(){var e="none",t=0,n=0,o=!1;s(),$(".bAcep, .bCanc, .editing-key").hide(200,"linear"),$(".undo, .redo").prop("disabled",!0),$(".redo-key, .undo-key").addClass("grey-out");var i=[$("#input-table").html()],a=0;function r(){$("#input-table tbody>tr>th").each(function(e){$(this).html(++e)})}function d(){$("#input-table > thead > tr").find("th").each(function(e,t){0==e?$(this).replaceWith('<th scope="col" style="width:10px">#</th>'):$(this).replaceWith('<th scope="col">'+e+"</th>")})}function l(){var e=$("#input-table").find("thead tr").find("th"),t="";return e.each(function(e,n){"buttons"==$(this).attr("name")?t+=colEdicHtml:t+=0==e?'<th scope="row"></th>':"<td></td>"}),t}function u(o="none"){if("none"!=e)$(e).addClass("selectedCell"),t=e.cellIndex,n=e.parentNode.rowIndex;else if("col"===o){var i=!1;$("#input-table > tbody > tr").each(function(o,a){if(o+1===n&&$(a).find("td").each(function(n,o){if((n===t||n+1===t||n+2===t)&&$(o).length)return e=o,u(),i=!0,!1}),!0===i)return!1})}else if("row"===o){i=!1;$("#input-table > tbody > tr").each(function(o,a){if(o!==n&&o+1!==n&&o+2!==n||$(a).find("td").each(function(n,o){if(n+1===t&&$(o).length)return e=o,u(),i=!0,!1}),!0===i)return!1})}$(".column-menu > button,.row-menu > button,.text-menu > button").removeAttr("disabled"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")}function c(){$(e).removeClass("selectedCell"),e="none",$(".column-menu > button,.row-menu > button,.text-menu > button").attr("disabled","disabled","disabled"),t=0,n=0,$(".keyboard-nav > div").not(".movement-key, .undo-key, .redo-key").addClass("grey-out")}function s(o){if(console.log("You were at: ["+n+"]["+t+"]"),"none"===e)n=1,t=1;else{if(function(e){var o=$("#input-table > tbody > tr").length,i=$("#input-table > thead > tr > th").length-1;if("up"===e)return 1===n;if("left"===e)return 1===t;if("down"===e)return n===o;if("right"===e)return t===i}(o))return console.log("No can do! Going out of bounds there."),!1;"up"===o?n-=1:"left"===o?t-=1:"down"===o?n+=1:"right"===o&&(t+=1)}console.log("You have gone to: ["+n+"]["+t+"]");var i=!1;$("#input-table > tbody > tr").each(function(o,a){if(o+1===n&&$(a).find("td").each(function(n,o){if(n+1===t){if($(o).length)return c(),e=o,i=!0,!1;console.log("No element")}}),!0===i)return!1}),u()}function b(){rowData=l(),$("<tr>"+rowData+"</tr>").insertBefore(e.closest("tr")),r(),u(),D()}function h(){rowData=l(),$("#input-table > tbody > tr").length<=0?($($("#input-table").find("tbody")).append("<tr>"+rowData+"</tr>"),$(".bElim, .bEdit, .bAddRowUp").show(200,"linear"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!1),s("down")):$("<tr>"+rowData+"</tr>").insertAfter(e.closest("tr")),r(),u(),D()}function f(){$("#input-table thead tr th").each(function(e,n){e==t&&$('<th scope="col">'+e+"</th>").insertBefore(n)}),$("#input-table tbody tr").each(function(){$(this).find("td").each(function(e,n){if(e+1==t)return $("<td></td>").insertBefore(n),!1})}),d(),u(),D()}function p(){1===$("#input-table > thead > tr > th").length?($("#input-table > thead > tr").append('<th scope="col">1</th>'),$("#input-table tbody tr").each(function(){$(this).append("<td></td>")}),$(".bAddColumnLeft, .bDeleteColumn").show(200,"linear"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!1),s("right")):($("#input-table thead tr th").each(function(e,n){e==t&&$('<th scope="col">'+e+"</th>").insertAfter(n)}),$("#input-table tbody tr").each(function(){$(this).find("td").each(function(e,n){if(e+1==t)return $("<td></td>").insertAfter(n),!1})}),u()),d(),D()}function y(){o=!0,$(".generate-table-button > button, .text-menu > button, .column-menu > button").attr("disabled","disabled","disabled"),$(".keyboard-nav > div").hide(200,"linear"),$(".editing-key").show(200,"linear"),rowEdit(e),$(e).find("input").focus()}function m(){rowAcep(e),$(".generate-table-button > button, .text-menu > button, .column-menu > button").removeAttr("disabled"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),o=!1,D()}function k(){var e=new Array;$(".generate-table-button > button").html('Converting...<i class="fas fa-circle-notch fa-spin ml-2"></i>'),$("#input-table > tbody > tr").each(function(){var t=new Array;$(this).find("td").each(function(){var e=$(this).html();""===e?t.push(" "):t.push(e)}),e.push(t)});var t=JSON.stringify(e),n="none",o="none";"true"===shouldLoadTable?(n="edit-csv",o=fileID):n="insert",console.log(n+o),$.ajax({type:"POST",url:Flask.url_for("insert_and_convert",{operation:n,file_id:o}),data:t,processData:!1,contentType:"application/json",dataType:"json"}).done(e=>{$(".generate-table-button > button").html("Generate"),function(e){$("#result-container").remove(),$("#result-rule").remove();var t='<hr id="result-rule" size="2" width="100%" align="center" noshade>';t+='<div id="result-container" class="result-container"><h1>Your converted table</h1>',t+='<div class="card result-box mt-5"><div class="grid-child result-text darkerbg">'+e.resultTable+"</div>",t+='<div class="grid-child links"><a href="'+Flask.url_for("get_table",{view_type:"raw",file_id:e.resultFileID})+'" class="btn submit-download-link">Raw</a>',t+='<a href="'+Flask.url_for("get_table",{view_type:"download",file_id:e.resultFileID})+'" class="btn submit-download-link">Download</a></div></div></div>',$(t).insertAfter("#input-table-card"),window.scrollTo(0,$("hr").offset().top)}(e)}).fail(e=>{console.log("Error during file convert: "+e)})}function v(){var t=$(e).html();if(""!=t&&!t.includes("<del>")){var n="<del>"+t+"</del>";$(e).html(n)}}function g(){var t=$(e).html();if(""!=t&&!t.includes("<i>")){var n="<i>"+t+"</i>";$(e).html(n)}D()}function w(){rowElim(e),$("#input-table > tbody > tr").length<=0?(c(),$(".bElim, .bEdit, .bAddRowUp").hide(200,"linear"),$(".row-menu > button").removeAttr("disabled"),$(".generate-table-button > button").prop("disabled",!0),A("T","Add Row Below"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")):u("row"),D()}function C(){rowCancel(e),$(".generate-table-button > button, .text-menu > button, .column-menu > button").removeAttr("disabled"),$(".keyboard-nav > div").show(200,"linear"),$(".editing-key").hide(200,"linear"),o=!1}function A(e,t){$(".keyboard-nav .key-description").each(function(){-1===t.indexOf($(this).text())&&$(this).hide(200,"linear")}),$(".keyboard-nav .key-name").each(function(){-1===e.indexOf($(this).text())&&$(this).hide(200,"linear")})}function K(){$("#input-table thead tr th").each(function(e,n){e==t&&n.remove()}),$("#input-table tbody tr").each(function(){$(this).find("td").each(function(e,n){if(e+1==t)return n.remove(),!1})}),1===$("#input-table > thead > tr > th").length?(c(),$(".bAddColumnLeft, .bDeleteColumn").hide(200,"linear"),$(".generate-table-button > button").prop("disabled",!0),$(".column-menu > button").removeAttr("disabled"),A("X","Add Col Right"),$(".keyboard-nav > div").not(".undo-key, .redo-key").removeClass("grey-out")):(e="none",u("col")),d()}function D(){10===i.length&&i.shift();let e=i.length-a-1;for(let t=0;t<e;t++)i.pop();var t=$("#input-table").html();i.push(t),a=i.length-1,$(".undo").prop("disabled")&&($(".undo").prop("disabled",!1),$(".undo-key").removeClass("grey-out")),$(".redo").prop("disabled",!0),$(".redo-key").addClass("grey-out")}function x(){$("#input-table > tbody > tr > td").each(function(t,n){if($(n).hasClass("selectedCell"))return c(),e=n,!1}),u()}$("#input-table").SetEditable({onAdd:function(){r()},onDelete:function(){e="none",r()}}),$(document).on("click","#input-table > tbody > tr > td",function(t){o||e==t.target||($(e).removeClass("selectedCell"),e=t.target,u())}),$(document).on("click",".undo",function(){a>0&&($("#input-table").html("").append(i[a-1]),0===(a-=1)&&($(".undo").prop("disabled",!0),$(".undo-key").addClass("grey-out")),$(".redo").prop("disabled")&&($(".redo").prop("disabled",!1),$(".redo-key").removeClass("grey-out")));x()}),$(document).on("click",".redo",function(){a<i.length-1&&($("#input-table").html("").append(i[a+1]),(a+=1)===i.length-1&&($(".redo").prop("disabled",!0),$(".redo-key").addClass("grey-out")),$(".undo").prop("disabled")&&($(".undo-key").addClass("grey-out"),$(".undo").prop("disabled",!1)));x()}),$(document).on("click",".bAddRowUp",b),$(document).on("click",".bAddRowDown",h),$(document).on("click",".bAddColumnLeft",f),$(document).on("click",".bAddColumnRight",p),$(document).on("click",".bDeleteColumn",K),$(document).on("click",".bEdit",y),$(document).on("click",".bAcep",m),$(document).on("click",".bCanc",C),$(document).on("click",".bElim",w),$(document).on("click",".make-bold",function(){var t=$(e).html();if(""!=t&&!t.includes("<b>")){var n="<b>"+t+"</b>";$(e).html(n)}D()}),$(document).on("click",".make-italic",g),$(document).on("click",".make-strikethrough",v),$(document).on("click",".bGenerateTable",k),$(this).keypress(function(t){if(o)switch(t.code){case"KeyJ":m();break;case"KeyK":C()}else if("none"!=e)switch(t.code){case"KeyW":s("up");break;case"KeyA":s("left");break;case"KeyS":s("down");break;case"KeyD":case"KeyU":s("right");break;case"KeyI":case"KeyB":break;case"KeyN":g();break;case"KeyM":v();break;case"KeyZ":f();break;case"KeyC":K();break;case"KeyE":y();break;case"KeyR":b();break;case"KeyY":w();break;case"KeyG":k();break;case"KeyX":p();break;case"KeyT":h()}else switch(t.code){case"KeyG":k();break;case"KeyX":p();break;case"KeyT":h()}})});